name: Update Community Wall

on:
  watch:
    types: [started]  # áŠ áŠ•á‹µ áˆ°á‹ STAR áˆ²á‹«á‹°áˆ­áŒ á‰¥á‰» á‹­áŠáˆ³áˆ

jobs:
  add-user:
    runs-on: ubuntu-latest
    permissions:
      contents: write # áá‰¶á‹áŠ• áˆˆáˆ˜áˆˆáŒ á á‹¨áˆ˜áƒá áˆá‰ƒá‹µ á‹«áˆµáˆáˆáŒˆá‹‹áˆ

    steps:
    - uses: actions/checkout@v3

    - name: Python Setup
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Update README with New Member
      env:
        USER_LOGIN: ${{ github.actor }}
        USER_AVATAR: ${{ github.event.sender.avatar_url }}
        USER_URL: ${{ github.event.sender.html_url }}
      run: |
        python -c "import os, re, sys

        user_login = os.environ['USER_LOGIN']
        user_avatar = os.environ['USER_AVATAR']
        user_url = os.environ['USER_URL']
        
        # á‹¨ Hacker Style áŠ á‹¶ á‹áŒáŒ…á‰µ (áŠ­á‰¥ áá‰¶ áŠ¨á‰€á‹­ ááˆ¬áˆ áŒ‹áˆ­)
        new_entry = f'<a href=\"{user_url}\" title=\"{user_login}\"><img src=\"{user_avatar}\" width=\"60\" style=\"border-radius: 50%; border: 2px solid #FF0000; margin: 5px;\" /></a>'

        file_path = 'README.md'
        
        try:
            with open(file_path, 'r') as f:
                content = f.read()
            
            # áˆ°á‹á‹¨á‹ áŠ áˆµá‰€á‹µáˆ áŠ«áˆˆ áˆ˜á‹µáŒˆáˆ áŠ á‹«áˆµáˆáˆáŒáˆ
            if user_login in content:
                print(f'User {user_login} is already in the alliance.')
                sys.exit(0)

            # á‰¦á‰³á‹áŠ• áˆ˜áˆˆá‹¨á‰µ (Makers)
            start_marker = '<!-- STARG_START -->'
            end_marker = '<!-- STARG_END -->'
            
            pattern = re.compile(f'({start_marker})(.*?)({end_marker})', re.DOTALL)
            match = pattern.search(content)
            
            if match:
                current_members = match.group(2)
                # áŠ á‹²áˆ±áŠ• áˆ°á‹ áŠ¨áŠá‰µ áˆ˜áŒ¨áˆ˜áˆ­
                new_content = content.replace(current_members, f'\n{new_entry}{current_members}')
                
                with open(file_path, 'w') as f:
                    f.write(new_content)
                print(f'Successfully added {user_login} to the wall.')
            else:
                print('Error: Could not find markers in README.')
                sys.exit(1)

        except Exception as e:
            print(f'Error: {e}')
            sys.exit(1)
        "

    - name: Commit and Push
      run: |
        git config --global user.name "Hacker-Hall-of-Fame"
        git config --global user.email "bot@cipher-attack.com"
        # áˆˆá‹áŒ¥ áŠ«áˆˆ á‰¥á‰» áŠá‹ Commit á‹¨áˆšá‹«á‹°áˆ­áŒˆá‹
        git diff --quiet && git diff --staged --quiet || (git add README.md && git commit -m "ğŸ”¥ New Alliance Member: ${{ github.actor }}" && git push)